刚毕业出来找工作，面试官问了一道经典的面试题：从输入URL到页面呈现发生什么？嗯~_~，那时候我黑人问号  ?__?  ，啊哈哈^__^

从整体过程来说，当用户在地址栏输入URL进行查询会经历以下过程：

1. DNS域名解析；
2. TCP链接；
3. 发送HTTP请求；
4. 服务器响应；
5. 浏览器解析渲染页面。

#### DNS域名解析

概念：通过Internet去查找哪台机器有你刚好所需的资源。

浏览器在输入URL（http://baidu.com）并不是真正意义去查找这个，而是把该域名解析成对应的IP地址，在互联网中，每一台计算机都拥有唯一的标识：IP地址，但由于IP地址对正常人来说不好记忆，所以为了记忆便捷，才设计出域名这种方式。

#### TCP（Transmission Control Protocol，传输控制协议）

TCP是一种面向连接，可靠的，基于字节流的传输层协议。

它通过“三次握手”俩建立客户端与服务器的连接。何为“三次握手”？是指 在建立一个TCP连接时，客户端和服务器总共要发送三个数据包来确认连接的建立。作用：

- 确认双方的接收能力和发送能力
- 指定自己的初始化序列号，为后面的可靠性传输做准备

三次握手的过程：

1. **客户端-->服务器**：客户端发送SYN（synchronous 建立联机）报文给服务器，并且指明客户端初始序列号为ISN©（Initial Sequence Number  让对方知道接下来接收数据的时候如何按序列号组装数据），即以SYN=1，seq = x的形式发送过去，此时客户端处于SYN_SENT（请求连接）状态；
2. **服务器-->客户端**：服务器收到客户端的SYN和ISN©，也发送一个SYN回去，同时设置ACK=ISN©+1，以及指明服务器初始化序列号ISN（s），即以SYN=1，ACK=x+1，seq=y的形式发送给客户端；
3. **客户端-->服务器**：客户端收到服务器发送的消息后，设置ACK=ISN（s)+1,将自身的ISN+1，即以ACK=y+1，seq=x+1的形式发送给服务器。此时客户端处于ESTABLISHED阶段，服务器收到报文，也处于ESTABLISHED阶段，双方建立链接

#### 发送HTTP请求

发送HTTP请求的过程就是构建HTTP请求报文，并通过TCP协议发送到服务器指定端口。HTTP协议默认端口80/8080，HTTPS协议默认端口443.

HTTP请求报文有三部分组成：

- 请求行：常用方法：GET、POST、PUT、DELETE、HEAD、OPTIONS
- 请求头：允许客户端向服务器传递请求的附加信息和客户端自身的信息
- 请求正文：通过POST、PUT等方法向服务传递数据时，这些数据就存储在请求正文中

#### 服务器响应

服务器响应完成之后会返回HTTP响应报文。包括：状态码、响应报头、响应报文。

- 状态码：移步查看更详细的内容（https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status）；
- 响应报头：常见的响应报头字段有**Connection**、**Content-Type**、**Server**等；
- 响应报文：服务器返回给浏览器的文本的信息，通常HTML，JS，CSS，图片等文件就放在里面。

#### 浏览器解析渲染页面

浏览器的渲染的过程：

1. 解析HTML，生成DOM树；
2. 解析CSS，生成 CSS规则树（CSS Rule Tree）;
3. 将DOM树与CSS规则树结合起来，生成渲染树（Render Tree）；
4. 从根节点开始，计算每一个元素的大小位置，给出每一个节点在屏幕上的精确坐标，从而得到基于渲染树的布局渲染树（Layout of the render tree）；
5. 遍历渲染树，使用UI渲染引擎进行绘制，将整颗树绘制到页面上，这个过程叫做绘制渲染树（Painting the render tree）

